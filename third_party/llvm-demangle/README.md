copied from llvm src 7.0